{{ define "target_edit_page" }}
  {{ template "layout" . }}
{{ end }}

{{ define "content" }}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0">{{ if .IsNew }}New{{ else }}Edit{{ end }} Target</h1>
  <a class="btn btn-outline-secondary" href="/targets">Back</a>
</div>

<form method="post" action="/targets/edit" class="card">
  <div class="card-body">
    {{ if not .IsNew }}
      <input type="hidden" name="id" value="{{ .Target.ID }}">
    {{ end }}

    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Name</label>
        <input class="form-control" name="name" value="{{ .Target.Name }}" required>
      </div>

      <div class="col-md-2">
        <label class="form-label">Mode</label>
        <select class="form-select" name="mode">
          <option value="repos" {{ if eq .Target.Mode "repos" }}selected{{ end }}>repos</option>
          <option value="user"  {{ if eq .Target.Mode "user" }}selected{{ end }}>user</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Namespace</label>
        <input class="form-control" name="namespace" value="{{ .Target.Namespace }}" required>
      </div>

      <div class="col-md-3">
        <label class="form-label">Interval (seconds)</label>
        <input class="form-control" name="interval_seconds" value="{{ .Target.IntervalSeconds }}" required>
        <div class="form-text">Example: 900 = 15 minutes</div>
      </div>
    </div>

    <div class="mt-3">
      <label class="form-label">Repos (only for repos-mode)</label>
      <textarea class="form-control" name="repos_csv" rows="4" placeholder="repo1,repo2,repo3">{{ .Target.ReposCSV }}</textarea>
      <div class="form-text">
        Comma-separated. You can paste multiple lines; spaces will be stripped.
      </div>
    </div>

    <div class="form-check mt-3">
      <input class="form-check-input" type="checkbox" name="enabled" id="enabled" {{ if .Target.Enabled }}checked{{ end }}>
      <label class="form-check-label" for="enabled">Enabled</label>
    </div>

    {{ if .Target.LastRunUTC }}
    <div class="mt-3 small text-muted">
      Last run: {{ .Target.LastRunUTC }}
      {{ if .Target.LastError }}<span class="text-danger ms-2">Error: {{ .Target.LastError }}</span>{{ end }}
    </div>
    {{ end }}
  </div>

  <div class="card-footer d-flex gap-2">
    <button class="btn btn-primary" type="submit">Save</button>
    <a class="btn btn-outline-secondary" href="/targets">Cancel</a>
  </div>
</form>
{{ end }}

