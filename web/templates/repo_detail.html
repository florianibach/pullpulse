{{ define "repo_detail_page" }}
  {{ template "layout" . }}
{{ end }}

{{ define "content" }}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h3 mb-0">{{ .Repo.Namespace }}/{{ .Repo.Name }}</h1>
    <div class="text-muted small">Latest snapshots and derived deltas</div>
  </div>
  <a class="btn btn-outline-secondary" href="/repos">Back</a>
</div>

<div class="row g-3">
  <div class="col-12 col-xl-6">
    <div class="card">
      <div class="card-header">Snapshots (latest 50)</div>
      <div class="card-body">
        {{ if .Snaps }}
        <div class="d-flex flex-column gap-2">
          {{ range .Snaps }}
          <div class="border rounded p-3">
            <div class="d-flex justify-content-between align-items-start gap-2">
              <div class="min-w-0">
                <div class="text-muted small">Timestamp (UTC)</div>
                <div class="fw-semibold text-break">{{ .TSUTC }}</div>
              </div>
              <span class="badge text-bg-light">Snapshot</span>
            </div>

            <div class="mt-3 d-flex flex-wrap gap-4">
              <div>
                <div class="text-muted small">Pulls</div>
                <div class="fw-semibold">{{ .PullCount }}</div>
              </div>
              <div>
                <div class="text-muted small">Stars</div>
                <div class="fw-semibold">{{ .StarCount }}</div>
              </div>
              {{ if .LastUpdate }}
              <div>
                <div class="text-muted small">Last updated</div>
                <div class="fw-semibold text-break">{{ .LastUpdate }}</div>
              </div>
              {{ end }}
            </div>
          </div>
          {{ end }}
        </div>
        {{ else }}
        <div class="text-muted">No snapshots yet.</div>
        {{ end }}
      </div>
    </div>
  </div>

  <div class="col-12 col-xl-6">
    <div class="card">
      <div class="card-header">Deltas (latest 50)</div>
      <div class="card-body">
        {{ if .Deltas }}
        <div class="d-flex flex-column gap-2">
          {{ range .Deltas }}
          <div class="border rounded p-3">
            <div class="d-flex justify-content-between align-items-start gap-2">
              <div class="min-w-0">
                <div class="text-muted small">To (UTC)</div>
                <div class="fw-semibold text-break">{{ .ToTSUTC }}</div>
              </div>
              <span class="badge {{ if ge .Delta 0 }}text-bg-success{{ else }}text-bg-warning{{ end }}">
                {{ if ge .Delta 0 }}Delta{{ else }}Negative delta{{ end }}
              </span>
            </div>

            <div class="mt-3 d-flex flex-wrap gap-4">
              <div>
                <div class="text-muted small">Î” Pulls</div>
                <div class="fw-semibold">{{ .Delta }}</div>
              </div>
              <div>
                <div class="text-muted small">Per hour</div>
                <div class="fw-semibold">{{ printf "%.2f" .PerHour }}</div>
              </div>
              <div>
                <div class="text-muted small">Seconds</div>
                <div class="fw-semibold">{{ .Seconds }}</div>
              </div>
            </div>

            <div class="mt-2 text-muted small">
              From: {{ .FromTSUTC }}
            </div>
          </div>
          {{ end }}
        </div>
        {{ else }}
        <div class="text-muted">No deltas yet.</div>
        {{ end }}
      </div>
    </div>
  </div>
</div>
{{ end }}
