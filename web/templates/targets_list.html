{{ define "targets_list_page" }}
  {{ template "layout" . }}
{{ end }}

{{ define "content" }}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0">Targets</h1>
  <a class="btn btn-primary" href="/targets/new">New</a>
</div>

<div class="table-responsive">
  <table class="table table-sm align-middle">
    <thead>
      <tr>
        <th>Name</th>
        <th>Mode</th>
        <th>Namespace</th>
        <th>Repos</th>
        <th>Interval</th>
        <th>Enabled</th>
        <th>Last run</th>
        <th>Error</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {{ range .Targets }}
      <tr>
        <td class="fw-semibold">{{ .Name }}</td>
        <td><span class="badge text-bg-secondary">{{ .Mode }}</span></td>
        <td>{{ .Namespace }}</td>
        <td class="text-truncate" style="max-width: 320px;">{{ .ReposCSV }}</td>
        <td>{{ .IntervalSeconds }}s</td>
        <td>{{ if .Enabled }}✅{{ else }}—{{ end }}</td>
        <td class="text-muted">{{ .LastRunUTC }}</td>
        <td class="text-danger">{{ .LastError }}</td>
        <td>
          <a class="btn btn-sm btn-outline-primary" href="/targets/edit?id={{ .ID }}">Edit</a>
        </td>
      </tr>
      {{ end }}
      {{ if not .Targets }}
      <tr>
        <td colspan="9" class="text-muted">No targets yet. Create one.</td>
      </tr>
      {{ end }}
    </tbody>
  </table>
</div>

<div class="card mt-4">
  <div class="card-body">
    <h2 class="h5 mb-3">Quick add</h2>

    <form method="post" action="/targets">
      <div class="row g-2">
        <div class="col-md-3">
          <input class="form-control" name="name" placeholder="Name (e.g. floibach public)" required>
        </div>

        <div class="col-md-2">
          <select class="form-select" name="mode">
            <option value="repos">repos</option>
            <option value="user">user</option>
          </select>
        </div>

        <div class="col-md-2">
          <input class="form-control" name="namespace" placeholder="Namespace (user/org)" required>
        </div>

        <div class="col-md-3">
          <input class="form-control" name="repos_csv" placeholder="repos (comma sep, for repos-mode)">
        </div>

        <div class="col-md-2">
          <input class="form-control" name="interval_seconds" value="900" placeholder="interval seconds">
        </div>
      </div>

      <div class="form-check mt-3">
        <input class="form-check-input" type="checkbox" name="enabled" id="enabled" checked>
        <label class="form-check-label" for="enabled">Enabled</label>
      </div>

      <div class="mt-3">
        <button class="btn btn-success" type="submit">Create</button>
      </div>

      <div class="form-text mt-2">
        Tip: For user-mode, leave repos empty. For repos-mode, set repos_csv.
      </div>
    </form>
  </div>
</div>
{{ end }}
